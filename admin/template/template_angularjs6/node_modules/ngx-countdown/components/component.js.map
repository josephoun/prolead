{"version":3,"file":"component.js","sourceRoot":"","sources":["../../.ng_build/components/component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, ElementRef, ViewEncapsulation, Input, Renderer, OnChanges, SimpleChanges, OnDestroy, Output, EventEmitter, HostBinding, OnInit, SimpleChange } from '@angular/core';\nimport { Config } from './interfaces/config';\nimport { Hand } from './interfaces/hand';\nimport { Timer } from './timer';\n\n@Component({\n    selector: 'countdown',\n    template: `<ng-content></ng-content>`,\n    styleUrls: [ './component.css' ],\n    encapsulation: ViewEncapsulation.None\n})\nexport class CountdownComponent implements OnInit, OnChanges, OnDestroy {\n\n    private frequency = 1000;\n    private _notify: any = {};\n    private hands: Hand[] = [];\n    private left = 0;\n    private parsed = false;\n    private stoped = false;\n\n    @Input() config: Config;\n    @Output() start = new EventEmitter();\n    @Output() finished = new EventEmitter();\n    @Output() notify = new EventEmitter();\n    @Output() event = new EventEmitter<{ action: string, left: number }>();\n\n    @HostBinding('class')\n    cls: string;\n\n    constructor(private el: ElementRef,\n        private renderer: Renderer,\n        private timer: Timer) {\n        this.timer.start();\n    }\n\n    ngOnInit() {\n        this.mergeConfig();\n        this.init();\n        if (!this.config.demand) this.begin();\n    }\n\n    ngOnDestroy(): void {\n        this.destroy();\n    }\n\n    ngOnChanges(changes: { [P in keyof this]?: SimpleChange } & SimpleChanges): void {\n        if (!changes.config.firstChange) {\n            this.mergeConfig();\n            this.destroy().init();\n        }\n    }\n\n    begin() {\n        this.parsed = false;\n        this.callEvent('start');\n    }\n\n    restart(): void  {\n        if (!this.stoped) this.destroy();\n        this.init();\n        this.timer.start();\n        this.callEvent('restart');\n    }\n\n    stop() {\n        if (this.stoped) return;\n        this.stoped = true;\n        this.destroy();\n        this.callEvent('stop');\n    }\n\n    pause() {\n        if (this.stoped || this.parsed) return ;\n        this.parsed = true;\n        this.callEvent('pause');\n    }\n\n    resume() {\n        if (this.stoped || !this.parsed) return ;\n        this.parsed = false;\n        this.callEvent('resume');\n    }\n\n    private mergeConfig() {\n        this.config = Object.assign(<Config>{\n            demand: false,\n            leftTime: 0,\n            template: '$!h!时$!m!分$!s!秒',\n            size: 'lite',\n            effect: 'normal',\n            varRegular: /\\$\\!([\\-\\w]+)\\!/g,\n            clock: ['d', 100, 2, 'h', 24, 2, 'm', 60, 2, 's', 60, 2, 'u', 10, 1]\n        }, this.config);\n    }\n\n    private callEvent(action: string) {\n        this.event.emit({ action, left: this.left });\n    }\n\n    private init() {\n        const me = this;\n        const el = me.el.nativeElement;\n        me.parsed = me.config.demand;\n        me.stoped = false;\n\n        this.cls = `count-down ${me.config.size} ${me.config.className || ''}`;\n\n        // 分析markup\n        const tmpl = el.innerHTML || me.config.template;\n        me.config.varRegular.lastIndex = 0;\n        el.innerHTML = tmpl.replace(me.config.varRegular, (str: string, type: string) => {\n            // 时钟频率校正.\n            if (type === 'u' || type === 's-ext')\n                me.frequency = 100;\n\n            // 生成hand的markup\n            let content = '';\n            if (type === 's-ext') {\n                me.hands.push({ type: 's' });\n                me.hands.push({ type: 'u' });\n                content = me.html('', 's', 'handlet') +\n                    me.html('.', '', 'digital') +\n                    me.html('', 'u', 'handlet');\n            } else {\n                me.hands.push({ type: type });\n            }\n\n            return me.html(content, type, 'hand');\n        });\n\n        const clock = me.config.clock;\n        me.hands.forEach((hand: Hand) => {\n            const type = hand.type;\n            let base = 100,\n                i: number;\n\n            hand.node = el.querySelector(`.hand-${type}`);\n            // radix, bits 初始化\n            for (i = clock.length - 3; i > -1; i -= 3) {\n                if (type === clock[i]) {\n                    break;\n                }\n\n                base *= clock[i + 1];\n            }\n            hand.base = base;\n            hand.radix = clock[i + 1];\n            hand.bits = clock[i + 2];\n        });\n\n        me.getLeft();\n        me.reflow(0, true);\n\n        // bind reflow to me\n        const _reflow = me.reflow;\n        me.reflow = (count: number = 0) => {\n            return _reflow.apply(me, [count]);\n        };\n\n        // 构建 notify\n        if (me.config.notify) {\n            me.config.notify.forEach((time: number) => {\n                if (time < 1) throw new Error('由于当结束会调用 finished，所以 notify 通知必须全是正整数');\n                time = time * 1000;\n                time = time - time % me.frequency;\n                me._notify[time] = true;\n            });\n        }\n\n        me.start.emit();\n        me.timer.add(me.reflow, me.frequency);\n        // show\n        el.style.display = 'inline';\n\n        return me;\n    }\n\n    private destroy() {\n        this.timer.remove(this.reflow);\n        return this;\n    }\n\n    /**\n     * 更新时钟\n     */\n    private reflow(count: number = 0, force: boolean = false): void {\n        if (!force && (this.parsed || this.stoped)) return ;\n        const me = this;\n        me.left = me.left - me.frequency * count;\n\n        me.hands.forEach((hand: Hand) => {\n            hand.lastValue = hand.value;\n            hand.value = Math.floor(me.left / hand.base) % hand.radix;\n        });\n\n        me.repaint();\n\n        if (me._notify[me.left]) {\n            me.notify.emit(me.left);\n            this.callEvent('notify');\n        }\n\n        if (me.left < 1) {\n            me.finished.emit(0);\n            this.stoped = true;\n            this.callEvent('finished');\n            this.destroy();\n        }\n    }\n\n    /**\n     * 重绘时钟\n     */\n    private repaint(): void {\n        const me = this;\n        if (me.config.repaint) {\n            me.config.repaint.apply(me);\n            return;\n        }\n\n        let content: string;\n\n        me.hands.forEach((hand: Hand) => {\n            if (hand.lastValue !== hand.value) {\n                content = '';\n\n                me.toDigitals(hand.value, hand.bits).forEach((digital: number) => {\n                    content += me.html(digital.toString(), '', 'digital');\n                });\n\n                hand.node.innerHTML = content;\n            }\n        });\n    }\n\n    /**\n     * 获取倒计时剩余帧数\n     */\n    private getLeft(): void {\n        let left: number = this.config.leftTime * 1000;\n        const end: number = this.config.stopTime;\n\n        if (!left && end)\n            left = end - new Date().getTime();\n\n        this.left = left - left % this.frequency;\n    }\n\n    /**\n     * 生成需要的html代码，辅助工具\n     */\n    private html(con: string | any[], className: string, type: string): string {\n        if (con instanceof Array) {\n            con = con.join('');\n        }\n\n        switch (type) {\n            case 'hand':\n            case 'handlet':\n                className = type + ' hand-' + className;\n                break;\n            case 'digital':\n                if (con === '.') {\n                    className = type + ' ' + type + '-point ' + className;\n                } else {\n                    className = type + ' ' + type + '-' + con + ' ' + className;\n                }\n                break;\n        }\n        return '<span class=\"' + className + '\">' + con + '</span>';\n    }\n\n    /**\n     * 把值转换为独立的数字形式\n     */\n    private toDigitals(value: number, bits: number): number[] {\n        value = value < 0 ? 0 : value;\n        const digitals = [];\n        // 把时、分、秒等换算成数字.\n        while (bits--) {\n            digitals[bits] = value % 10;\n            value = Math.floor(value / 10);\n        }\n        return digitals;\n    }\n\n}\n"]}